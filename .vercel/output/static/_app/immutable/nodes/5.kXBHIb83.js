import{s as ie,A as te,B as se,b as D,f as m,m as d,i as C,h as w,n as G,e as I,a as j,c as S,g as B,w as M,C as de,o as K,p as $e,y as Ae,k as Se,x as ue,t as q,d as R,j as W,E as He,z as re,G as Pe,N as he,K as ee}from"../chunks/scheduler.DCRTzJa9.js";import{S as ne,i as oe,b as X,d as Y,m as Z,a as E,g as L,t as N,c as F,f as x,h as le,e as Ve}from"../chunks/index.ry5Ra-Ly.js";import{e as ae,u as je,o as Be}from"../chunks/each.PK6sAFCL.js";import{a as Q}from"../chunks/index.1TP0rt78.js";import{a as pe,b as Oe,q as Me,c as Ue,d as qe,o as Re}from"../chunks/firebase.ldIwJ5_z.js";import{p as Ce}from"../chunks/stores.5MMSktsx.js";import{t as me}from"../chunks/utils.W3KuLhvY.js";import{P as Ne}from"../chunks/ProfilePic.61gLdwPY.js";import{a as Je}from"../chunks/store.-1J7pbUR.js";import{T as Le}from"../chunks/Trash.k2u1Lcjy.js";function Fe(i){let e,t;return{c(){e=te("svg"),t=te("path"),this.h()},l(s){e=se(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=D(e);t=se(l,"path",{d:!0}),D(t).forEach(m),l.forEach(m),this.h()},h(){d(t,"d","M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 005.135 9.25h6.115a.75.75 0 010 1.5H5.135a1.5 1.5 0 00-1.442 1.086l-1.414 4.926a.75.75 0 00.826.95 28.896 28.896 0 0015.293-7.154.75.75 0 000-1.115A28.897 28.897 0 003.105 2.289z"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"viewBox","0 0 20 20"),d(e,"fill","currentColor"),d(e,"class",i[0])},m(s,l){C(s,e,l),w(e,t)},p(s,[l]){l&1&&d(e,"class",s[0])},i:G,o:G,d(s){s&&m(e)}}}function Ge(i,e,t){let{class:s=""}=e;return i.$$set=l=>{"class"in l&&t(0,s=l.class)},[s]}class Ke extends ne{constructor(e){super(),oe(this,e,Ge,Fe,ie,{class:0})}}function We(i){let e,t;return{c(){e=te("svg"),t=te("path"),this.h()},l(s){e=se(s,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var l=D(e);t=se(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),D(t).forEach(m),l.forEach(m),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"d","M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke-width","1.5"),d(e,"stroke","currentColor"),d(e,"class",i[0])},m(s,l){C(s,e,l),w(e,t)},p(s,[l]){l&1&&d(e,"class",s[0])},i:G,o:G,d(s){s&&m(e)}}}function Qe(i,e,t){let{class:s=""}=e;return i.$$set=l=>{"class"in l&&t(0,s=l.class)},[s]}class Xe extends ne{constructor(e){super(),oe(this,e,Qe,We,ie,{class:0})}}function _e(i){let e,t,s,l,a;return t=new Xe({props:{class:"w-6 h-6 "+(i[3]?"":"opacity-50")}}),{c(){e=I("button"),X(t.$$.fragment),this.h()},l(n){e=S(n,"BUTTON",{"data-tooltip":!0,type:!0,class:!0});var r=D(e);Y(t.$$.fragment,r),r.forEach(m),this.h()},h(){d(e,"data-tooltip","Make message a text alert"),d(e,"type","button"),d(e,"class","yuzui !px-2")},m(n,r){C(n,e,r),Z(t,e,null),s=!0,l||(a=K(e,"click",i[7]),l=!0)},p(n,r){const o={};r&8&&(o.class="w-6 h-6 "+(n[3]?"":"opacity-50")),t.$set(o)},i(n){s||(E(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&m(e),x(t),l=!1,a()}}}function Ye(i){let e,t,s,l,a=i[4]?.data?.party?.hosts?.includes(i[4]?.data?.uid),n,r,o,f,b,u,h,c=a&&_e(i);return o=new Ke({props:{class:`w-4 h-5 ${i[2]?"opacity-0":""}`}}),{c(){e=I("form"),t=I("div"),s=I("input"),l=j(),c&&c.c(),n=j(),r=I("button"),X(o.$$.fragment),this.h()},l(v){e=S(v,"FORM",{class:!0});var _=D(e);t=S(_,"DIV",{class:!0});var P=D(t);s=S(P,"INPUT",{class:!0,placeholder:!0}),P.forEach(m),l=B(_),c&&c.l(_),n=B(_),r=S(_,"BUTTON",{type:!0,class:!0});var H=D(r);Y(o.$$.fragment,H),H.forEach(m),_.forEach(m),this.h()},h(){d(s,"class","h-full w-full flex-grow !px-4"),d(s,"placeholder","type a message..."),s.required=!0,d(t,"class","yuzui w-full"),d(r,"type","submit"),d(r,"class","yuzui after:!right-[14px] !px-3"),M(r,"loading",i[2]),M(r,"disabled",!i[4]?.data?.party?.attendees?.[i[4]?.data?.uid]?.status),d(e,"class",f=i[0]+" yuzui-row")},m(v,_){C(v,e,_),w(e,t),w(t,s),de(s,i[1]),w(e,l),c&&c.m(e,null),w(e,n),w(e,r),Z(o,r,null),b=!0,u||(h=[K(s,"input",i[6]),K(e,"submit",$e(i[5]))],u=!0)},p(v,[_]){_&2&&s.value!==v[1]&&de(s,v[1]),_&16&&(a=v[4]?.data?.party?.hosts?.includes(v[4]?.data?.uid)),a?c?(c.p(v,_),_&16&&E(c,1)):(c=_e(v),c.c(),E(c,1),c.m(e,n)):c&&(L(),N(c,1,1,()=>{c=null}),F());const P={};_&4&&(P.class=`w-4 h-5 ${v[2]?"opacity-0":""}`),o.$set(P),(!b||_&4)&&M(r,"loading",v[2]),(!b||_&16)&&M(r,"disabled",!v[4]?.data?.party?.attendees?.[v[4]?.data?.uid]?.status),(!b||_&1&&f!==(f=v[0]+" yuzui-row"))&&d(e,"class",f)},i(v){b||(E(c),E(o.$$.fragment,v),b=!0)},o(v){N(c),N(o.$$.fragment,v),b=!1},d(v){v&&m(e),c&&c.d(),x(o),u=!1,Ae(h)}}}function Ze(i,e,t){let s;Se(i,Ce,u=>t(4,s=u));let{class:l=""}=e,a="",n=!1,r=!1;const o=async()=>{t(2,n=!0);try{await fetch("/api/party/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partyId:s.data.party?.id,message:a,textAlert:r})})}catch{Je("Error sending message")}t(2,n=!1),t(1,a=""),t(3,r=!1)};function f(){a=this.value,t(1,a)}const b=()=>t(3,r=!r);return i.$$set=u=>{"class"in u&&t(0,l=u.class)},[l,a,n,r,s,o,f,b]}class xe extends ne{constructor(e){super(),oe(this,e,Ze,Ye,ie,{class:0})}}function ge(i,e,t){const s=i.slice();return s[16]=e[t],s}function be(i,e,t){const s=i.slice();return s[19]=e[t][0],s[20]=e[t][1].name,s}function ve(i){let e,t,s,l,a,n,r,o=ae(i[1].splice(0,3)),f=[];for(let u=0;u<o.length;u+=1)f[u]=ke(be(i,o,u));const b=u=>N(f[u],1,1,()=>{f[u]=null});return{c(){for(let u=0;u<f.length;u+=1)f[u].c();e=j(),t=I("a"),s=I("div"),l=q(i[8]),a=q(" attending"),this.h()},l(u){for(let v=0;v<f.length;v+=1)f[v].l(u);e=B(u),t=S(u,"A",{"data-sveltekit-noscroll":!0,href:!0,class:!0});var h=D(t);s=S(h,"DIV",{class:!0});var c=D(s);l=R(c,i[8]),a=R(c," attending"),c.forEach(m),h.forEach(m),this.h()},h(){d(s,"class","text-sm"),d(t,"data-sveltekit-noscroll",""),d(t,"href",n=i[9].data.pathname+"/people"),d(t,"class","h-10 yuzui flex items-center whitespace-nowrap border-b-0 !px-2")},m(u,h){for(let c=0;c<f.length;c+=1)f[c]&&f[c].m(u,h);C(u,e,h),C(u,t,h),w(t,s),w(s,l),w(s,a),r=!0},p(u,h){if(h&2){o=ae(u[1].splice(0,3));let c;for(c=0;c<o.length;c+=1){const v=be(u,o,c);f[c]?(f[c].p(v,h),E(f[c],1)):(f[c]=ke(v),f[c].c(),E(f[c],1),f[c].m(e.parentNode,e))}for(L(),c=o.length;c<f.length;c+=1)b(c);F()}(!r||h&256)&&W(l,u[8]),(!r||h&512&&n!==(n=u[9].data.pathname+"/people"))&&d(t,"href",n)},i(u){if(!r){for(let h=0;h<o.length;h+=1)E(f[h]);r=!0}},o(u){f=f.filter(Boolean);for(let h=0;h<f.length;h+=1)N(f[h]);r=!1},d(u){u&&(m(e),m(t)),He(f,u)}}}function ke(i){let e,t;return e=new Ne({props:{class:"w-10 h-10 yuzui -mr-[1px] object-cover yuzui-bg-dots",uid:i[19],name:i[20]}}),{c(){X(e.$$.fragment)},l(s){Y(e.$$.fragment,s)},m(s,l){Z(e,s,l),t=!0},p(s,l){const a={};l&2&&(a.uid=s[19]),l&2&&(a.name=s[20]),e.$set(a)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){x(e,s)}}}function et(i){let e,t="no messages yet",s;return{c(){e=I("div"),e.textContent=t,this.h()},l(l){e=S(l,"DIV",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-1g06cfb"&&(e.textContent=t),this.h()},h(){d(e,"class","p-4 flex items-center justify-center h-full")},m(l,a){C(l,e,a)},p:G,i(l){l&&(s||re(()=>{s=Ve(e,Q,{duration:300}),s.start()}))},o:G,d(l){l&&m(e)}}}function tt(i){let e,t=[],s=new Map,l,a,n=ae(i[3].slice(-i[4]));const r=o=>o[16].id;for(let o=0;o<n.length;o+=1){let f=ge(i,n,o),b=r(f);s.set(b,t[o]=De(b,f))}return{c(){e=I("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=S(o,"DIV",{class:!0});var f=D(e);for(let b=0;b<t.length;b+=1)t[b].l(f);f.forEach(m),this.h()},h(){d(e,"class","divide-y")},m(o,f){C(o,e,f);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null);a=!0},p(o,f){f&1177&&(n=ae(o[3].slice(-o[4])),L(),t=je(t,f,r,1,o,n,s,e,Be,De,null,ge),F())},i(o){if(!a){for(let f=0;f<n.length;f+=1)E(t[f]);o&&(l||re(()=>{l=Ve(e,Q,{delay:300}),l.start()})),a=!0}},o(o){for(let f=0;f<t.length;f+=1)N(t[f]);a=!1},d(o){o&&m(e);for(let f=0;f<t.length;f+=1)t[f].d()}}}function st(i){let e,t,s,l;return{c(){e=I("div"),t=q(i[6]),this.h()},l(a){e=S(a,"DIV",{class:!0});var n=D(e);t=R(n,i[6]),n.forEach(m),this.h()},h(){d(e,"class","p-4 flex items-center justify-center h-full font-medium")},m(a,n){C(a,e,n),w(e,t),l=!0},p(a,n){(!l||n&64)&&W(t,a[6])},i(a){l||(a&&re(()=>{l&&(s||(s=le(e,Q,{duration:300},!0)),s.run(1))}),l=!0)},o(a){a&&(s||(s=le(e,Q,{duration:300},!1)),s.run(0)),l=!1},d(a){a&&m(e),a&&s&&s.end()}}}function ye(i){let e,t,s,l,a,n,r=(i[0].party?.attendees?.[i[16].uid]?.name||"???")+"",o,f,b=i[0].party?.hosts.includes(i[16].uid),u,h,c=me(new Date(i[16].timestamp))+"",v,_,P,H=i[0].party?.hosts.includes(i[0].uid)||i[0].uid===i[16].uid&&!i[16].alert,J,g,p,y;t=new Ne({props:{uid:i[16].uid,name:i[0].party?.attendees?.[i[16].uid]?.name||"",class:"shrink-0 h-16 w-16 object-cover "}});let T=b&&we(),V=H&&Ee(i),$=i[16].alert&&Te(i),A=i[16].message&&ze(i);return{c(){e=I("div"),X(t.$$.fragment),s=j(),l=I("div"),a=I("div"),n=I("span"),o=q(r),f=j(),T&&T.c(),u=j(),h=I("span"),v=q(c),_=q(" ago"),P=j(),V&&V.c(),J=j(),$&&$.c(),g=j(),A&&A.c(),p=j(),this.h()},l(k){e=S(k,"DIV",{class:!0});var z=D(e);Y(t.$$.fragment,z),s=B(z),l=S(z,"DIV",{class:!0});var O=D(l);a=S(O,"DIV",{class:!0});var U=D(a);n=S(U,"SPAN",{class:!0});var ce=D(n);o=R(ce,r),ce.forEach(m),f=B(U),T&&T.l(U),u=B(U),h=S(U,"SPAN",{class:!0});var fe=D(h);v=R(fe,c),_=R(fe," ago"),fe.forEach(m),P=B(U),V&&V.l(U),U.forEach(m),J=B(O),$&&$.l(O),g=B(O),A&&A.l(O),O.forEach(m),p=B(z),z.forEach(m),this.h()},h(){d(n,"class","text-sm font-semibold"),M(n,"bg-primary",i[16].hidden),d(h,"class","text-sm font-light text-primary text-opacity-50"),M(h,"bg-primary",i[16].hidden),d(a,"class","flex items-center gap-2 w-full flex-wrap"),d(l,"class","p-2 border-l w-full"),d(e,"class","message flex svelte-149p0b3"),M(e,"pointer-events-none",i[16].hidden)},m(k,z){C(k,e,z),Z(t,e,null),w(e,s),w(e,l),w(l,a),w(a,n),w(n,o),w(a,f),T&&T.m(a,null),w(a,u),w(a,h),w(h,v),w(h,_),w(a,P),V&&V.m(a,null),w(l,J),$&&$.m(l,null),w(l,g),A&&A.m(l,null),w(e,p),y=!0},p(k,z){const O={};z&24&&(O.uid=k[16].uid),z&25&&(O.name=k[0].party?.attendees?.[k[16].uid]?.name||""),t.$set(O),(!y||z&25)&&r!==(r=(k[0].party?.attendees?.[k[16].uid]?.name||"???")+"")&&W(o,r),(!y||z&24)&&M(n,"bg-primary",k[16].hidden),z&25&&(b=k[0].party?.hosts.includes(k[16].uid)),b?T||(T=we(),T.c(),T.m(a,u)):T&&(T.d(1),T=null),(!y||z&24)&&c!==(c=me(new Date(k[16].timestamp))+"")&&W(v,c),(!y||z&24)&&M(h,"bg-primary",k[16].hidden),z&25&&(H=k[0].party?.hosts.includes(k[0].uid)||k[0].uid===k[16].uid&&!k[16].alert),H?V?(V.p(k,z),z&25&&E(V,1)):(V=Ee(k),V.c(),E(V,1),V.m(a,null)):V&&(L(),N(V,1,1,()=>{V=null}),F()),k[16].alert?$?$.p(k,z):($=Te(k),$.c(),$.m(l,g)):$&&($.d(1),$=null),k[16].message?A?A.p(k,z):(A=ze(k),A.c(),A.m(l,null)):A&&(A.d(1),A=null),(!y||z&24)&&M(e,"pointer-events-none",k[16].hidden)},i(k){y||(E(t.$$.fragment,k),E(V),y=!0)},o(k){N(t.$$.fragment,k),N(V),y=!1},d(k){k&&m(e),x(t),T&&T.d(),V&&V.d(),$&&$.d(),A&&A.d()}}}function we(i){let e,t="HOST";return{c(){e=I("span"),e.textContent=t,this.h()},l(s){e=S(s,"SPAN",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-i6pyd6"&&(e.textContent=t),this.h()},h(){d(e,"class","text-sm font-medium text-accent")},m(s,l){C(s,e,l)},d(s){s&&m(e)}}}function Ee(i){let e,t,s,l,a;t=new Le({props:{class:"h-3 w-3"}});function n(){return i[11](i[16])}return{c(){e=I("button"),X(t.$$.fragment),this.h()},l(r){e=S(r,"BUTTON",{class:!0});var o=D(e);Y(t.$$.fragment,o),o.forEach(m),this.h()},h(){d(e,"class","delete-button ml-auto transition-opacity active:!opacity-50 svelte-149p0b3")},m(r,o){C(r,e,o),Z(t,e,null),s=!0,l||(a=K(e,"click",n),l=!0)},p(r,o){i=r},i(r){s||(E(t.$$.fragment,r),s=!0)},o(r){N(t.$$.fragment,r),s=!1},d(r){r&&m(e),x(t),l=!1,a()}}}function Te(i){let e,t=i[16].alert+"",s;return{c(){e=I("div"),s=q(t),this.h()},l(l){e=S(l,"DIV",{class:!0});var a=D(e);s=R(a,t),a.forEach(m),this.h()},h(){d(e,"class","mt-1 opacity-50 italic")},m(l,a){C(l,e,a),w(e,s)},p(l,a){a&24&&t!==(t=l[16].alert+"")&&W(s,t)},d(l){l&&m(e)}}}function ze(i){let e,t=i[16].message+"",s;return{c(){e=I("div"),s=q(t),this.h()},l(l){e=S(l,"DIV",{class:!0});var a=D(e);s=R(a,t),a.forEach(m),this.h()},h(){d(e,"class","mt-1"),M(e,"bg-primary",i[16].hidden)},m(l,a){C(l,e,a),w(e,s)},p(l,a){a&24&&t!==(t=l[16].message+"")&&W(s,t),a&24&&M(e,"bg-primary",l[16].hidden)},d(l){l&&m(e)}}}function De(i,e){let t,s,l,a=e[0].party?.attendees?.[e[16].uid]?.status!=="block"&&!e[7][e[16].id]&&ye(e);return{key:i,first:null,c(){t=ee(),a&&a.c(),s=ee(),this.h()},l(n){t=ee(),a&&a.l(n),s=ee(),this.h()},h(){this.first=t},m(n,r){C(n,t,r),a&&a.m(n,r),C(n,s,r),l=!0},p(n,r){e=n,e[0].party?.attendees?.[e[16].uid]?.status!=="block"&&!e[7][e[16].id]?a?(a.p(e,r),r&153&&E(a,1)):(a=ye(e),a.c(),E(a,1),a.m(s.parentNode,s)):a&&(L(),N(a,1,1,()=>{a=null}),F())},i(n){l||(E(a),l=!0)},o(n){N(a),l=!1},d(n){n&&(m(t),m(s)),a&&a.d(n)}}}function Ie(i){let e,t,s,l="->",a,n,r,o,f,b;return{c(){e=I("div"),t=I("button"),s=I("span"),a=q(l),n=q(`
			see updates`),this.h()},l(u){e=S(u,"DIV",{class:!0});var h=D(e);t=S(h,"BUTTON",{class:!0});var c=D(t);s=S(c,"SPAN",{class:!0});var v=D(s);a=R(v,l),v.forEach(m),n=R(c,`
			see updates`),c.forEach(m),h.forEach(m),this.h()},h(){d(s,"class","rotate-90 h-4 w-4 inline-block"),d(t,"class","yuzui !text-sm !px-2"),d(e,"class","absolute bottom-16 left-1/2 -translate-x-1/2")},m(u,h){C(u,e,h),w(e,t),w(t,s),w(s,a),w(t,n),o=!0,f||(b=K(t,"click",i[14]),f=!0)},p:G,i(u){o||(u&&re(()=>{o&&(r||(r=le(e,Q,{duration:100},!0)),r.run(1))}),o=!0)},o(u){u&&(r||(r=le(e,Q,{duration:100},!1)),r.run(0)),o=!1},d(u){u&&m(e),u&&r&&r.end(),f=!1,b()}}}function lt(i){let e,t,s="Activity",l,a,n,r,o,f,b,u,h,c,v,_=i[0]?.party?.attendees?.[i[0].uid]?.status&&ve(i);const P=[st,tt,et],H=[];function J(p,y){return typeof p[3]>"u"?0:p[3].length?1:2}r=J(i),o=H[r]=P[r](i);let g=i[5]&&Ie(i);return u=new xe({props:{class:"sticky bottom-0 z-10  h-12 shrink-0 flex"}}),{c(){e=I("div"),t=I("div"),t.textContent=s,l=j(),_&&_.c(),a=j(),n=I("div"),o.c(),f=j(),g&&g.c(),b=j(),X(u.$$.fragment),this.h()},l(p){e=S(p,"DIV",{class:!0});var y=D(e);t=S(y,"DIV",{class:!0,"data-svelte-h":!0}),ue(t)!=="svelte-16mfoz"&&(t.textContent=s),l=B(y),_&&_.l(y),y.forEach(m),a=B(p),n=S(p,"DIV",{class:!0});var T=D(n);o.l(T),T.forEach(m),f=B(p),g&&g.l(p),b=B(p),Y(u.$$.fragment,p),this.h()},h(){d(t,"class","yuzui pl-4 h-10 w-full -mr-[1px] flex items-center border-b-0"),d(e,"class","flex justify-between items-center font-medium -mb-[1px]"),d(n,"class","h-full yuzui overflow-y-auto !border-b-0")},m(p,y){C(p,e,y),w(e,t),w(e,l),_&&_.m(e,null),C(p,a,y),C(p,n,y),H[r].m(n,null),i[12](n),C(p,f,y),g&&g.m(p,y),C(p,b,y),Z(u,p,y),h=!0,c||(v=K(n,"scroll",i[13]),c=!0)},p(p,[y]){p[0]?.party?.attendees?.[p[0].uid]?.status?_?(_.p(p,y),y&1&&E(_,1)):(_=ve(p),_.c(),E(_,1),_.m(e,null)):_&&(L(),N(_,1,1,()=>{_=null}),F());let T=r;r=J(p),r===T?H[r].p(p,y):(L(),N(H[T],1,1,()=>{H[T]=null}),F(),o=H[r],o?o.p(p,y):(o=H[r]=P[r](p),o.c()),E(o,1),o.m(n,null)),p[5]?g?(g.p(p,y),y&32&&E(g,1)):(g=Ie(p),g.c(),E(g,1),g.m(b.parentNode,b)):g&&(L(),N(g,1,1,()=>{g=null}),F())},i(p){h||(E(_),E(o),E(g),E(u.$$.fragment,p),h=!0)},o(p){N(_),N(o),N(g),N(u.$$.fragment,p),h=!1},d(p){p&&(m(e),m(a),m(n),m(f),m(b)),_&&_.d(),H[r].d(),i[12](null),g&&g.d(p),x(u,p),c=!1,v()}}}function at(i,e,t){let s,l,a;Se(i,Ce,g=>t(9,a=g));let{data:n}=e,r,o,f=30,b=!1,u="fetching...",h={};const c=async()=>{if(t(6,u="fetching..."),!n.token||!n.party?.id||!n.party.attendees?.[n.uid]?.status){t(3,o=void 0),t(6,u="RSVP to see and send messages");return}pe.currentUser||await Oe(pe,n.token);const g=Me(Ue(qe,"parties",n.party?.id,"blocks")),p=Re(g,async y=>{const T=[];y.forEach(k=>T.push({blockId:k.id,...k.data()}));const V=T.map(({messages:k,blockId:z})=>Object.entries(k).map(([O,U])=>({id:O,blockId:z,...U}))).flat().sort((k,z)=>k.timestamp-z.timestamp),$=o?"smooth":"auto",A=!o||r?.scrollTop+r?.clientHeight===r?.scrollHeight;t(3,o=V),await he(),A?r?.scrollTo({top:r.scrollHeight,behavior:$}):t(5,b=!0)});return()=>p()},v=async(g,p)=>{t(7,h[p]=!0,h);try{await fetch("/api/party/message",{method:"DELETE",body:JSON.stringify({partyId:n.party?.id,blockId:g,messageId:p})})}catch(y){t(7,h[p]=!1,h),console.error(y)}},_=g=>v(g.blockId,g.id);function P(g){Pe[g?"unshift":"push"](()=>{r=g,t(2,r)})}const H=async()=>{if(o&&o?.length>f&&r.scrollTop<=0){const g=r.scrollHeight;t(4,f+=30),await he(),r?.scrollTo({top:r.scrollHeight-g})}r.scrollTop+r.clientHeight===r.scrollHeight&&t(5,b=!1)},J=()=>{t(5,b=!1),r.scrollTo({top:r.scrollHeight,behavior:"smooth"})};return i.$$set=g=>{"data"in g&&t(0,n=g.data)},i.$$.update=()=>{i.$$.dirty&1&&t(1,s=Object.entries(n.party?.attendees||{}).filter(([,{status:g}])=>g==="yes")),i.$$.dirty&2&&t(8,l=s.length),i.$$.dirty&1&&c()},[n,s,r,o,f,b,u,h,l,a,v,_,P,H,J]}class mt extends ne{constructor(e){super(),oe(this,e,at,lt,ie,{data:0})}}export{mt as component};
